<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ Thống Phát Hiện Vượt Đèn Đỏ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            border-radius: 16px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .video-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .video-container video {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
        }

        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .video-container:hover .video-overlay {
            opacity: 1;
        }

        .violation-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .violation-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .violation-card:active {
            transform: translateY(0);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .video-container:fullscreen {
            background-color: #000;
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .video-container:-webkit-full-screen {
            background-color: #000;
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .video-container:-moz-full-screen {
            background-color: #000;
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .video-container:-ms-fullscreen {
            background-color: #000;
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .video-container:fullscreen video {
            max-width: 100vw;
            max-height: 100vh;
            width: auto;
            height: auto;
            object-fit: contain;
        }

        .video-container:-webkit-full-screen {
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .video-container:-webkit-full-screen video {
            max-width: 100vw;
            max-height: 100vh;
            width: auto;
            height: auto;
            object-fit: contain;
        }

        .video-container:-moz-full-screen {
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .video-container:-moz-full-screen video {
            max-width: 100vw;
            max-height: 100vh;
            width: auto;
            height: auto;
            object-fit: contain;
        }

        .video-container:-ms-fullscreen {
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .video-container:-ms-fullscreen video {
            max-width: 100vw;
            max-height: 100vh;
            width: auto;
            height: auto;
            object-fit: contain;
        }

        /* Ẩn overlay khi fullscreen để tránh che video */
        .video-container:fullscreen .video-overlay,
        .video-container:-webkit-full-screen .video-overlay,
        .video-container:-moz-full-screen .video-overlay,
        .video-container:-ms-fullscreen .video-overlay {
            display: none;
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-red-600 rounded-lg flex items-center justify-center">
                        <i class="fas fa-video text-white text-lg"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900">Hệ Thống Phát Hiện Vượt Đèn Đỏ</h1>
                        <p class="text-sm text-gray-500">Giám sát giao thông thông minh</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-right">
                        <div class="text-sm font-medium text-gray-900" id="current-time"></div>
                        <div class="text-xs text-gray-500" id="current-date"></div>
                    </div>
                    <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                        <i class="fas fa-circle text-white text-xs"></i>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 h-[calc(100vh-140px)]">
            <!-- Video Section -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 h-full">
                    <div class="p-4 border-b border-gray-200">
                        <h2 class="text-lg font-semibold text-gray-900 flex items-center">
                            <i class="fas fa-play-circle mr-2 text-blue-600"></i>
                            Video Giám Sát
                        </h2>
                    </div>

                    <div class="p-4 h-[calc(100%-80px)]">
                        <div class="video-container h-full bg-gray-900 rounded-lg overflow-hidden relative">
                            <video id="surveillance-video" class="w-full h-full object-contain" controls
                                preload="metadata">
                                <source src="../video/output_demo2p.mp4" type="video/mp4">
                                Trình duyệt không hỗ trợ video.
                            </video>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Control Panel -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 h-full flex flex-col">
                    <div class="p-4 border-b border-gray-200">
                        <h2 class="text-lg font-semibold text-gray-900 flex items-center">
                            <i class="fas fa-list mr-2 text-green-600"></i>
                            Danh Sách Vi Phạm
                        </h2>
                    </div>

                    <!-- Filter Section -->
                    <div class="p-4 border-b border-gray-200">
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Tìm kiếm biển số</label>
                                <input type="text" id="search-input" placeholder="Nhập biển số xe..."
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Lọc theo thời gian</label>
                                <select id="time-filter"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="all">Tất cả</option>
                                    <option value="today">Hôm nay</option>
                                    <option value="week">Tuần này</option>
                                    <option value="month">Tháng này</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Violations List -->
                    <div class="flex-1 overflow-y-auto p-4">
                        <div class="space-y-3" id="violations-list">
                            <!-- Violation items will be populated by JavaScript -->
                        </div>

                        <!-- Loading indicator -->
                        <div class="text-center py-8" id="loading-indicator" style="display: none;">
                            <div class="loading mx-auto mb-2"></div>
                            <p class="text-sm text-gray-500">Đang tải dữ liệu...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <!-- Detail Modal -->
    <div class="modal" id="detail-modal">
        <div class="modal-content">
            <div class="p-6">
                <!-- Modal Header -->
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">Chi Tiết Vi Phạm</h2>
                        <p class="text-sm text-gray-500" id="modal-license-plate">Biển số: ---</p>
                    </div>
                    <button id="close-modal" class="text-gray-400 hover:text-gray-600 transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <!-- Modal Content -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Left Column -->
                    <div class="space-y-6">
                        <!-- Ảnh vi phạm -->
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-3 flex items-center">
                                <i class="fas fa-camera mr-2 text-blue-600"></i>
                                Ảnh Vi Phạm
                            </h3>
                            <div class="bg-gray-100 rounded-lg overflow-hidden">
                                <img id="violation-image" src="" alt="Ảnh vi phạm" class="w-full h-64 object-cover">
                            </div>
                        </div>

                        <!-- Thông tin vi phạm -->
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-3 flex items-center">
                                <i class="fas fa-exclamation-triangle mr-2 text-red-600"></i>
                                Thông Tin Vi Phạm
                            </h3>
                            <div class="bg-gray-50 rounded-lg p-4 space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Thời gian:</span>
                                    <span class="font-medium" id="violation-time">---</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Địa điểm:</span>
                                    <span class="font-medium" id="violation-location">---</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Tốc độ:</span>
                                    <span class="font-medium" id="violation-speed">---</span>
                                </div>
                            </div>
                        </div>

                        <!-- Thông tin chủ sở hữu -->
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-3 flex items-center">
                                <i class="fas fa-user mr-2 text-green-600"></i>
                                Thông Tin Chủ Sở Hữu
                            </h3>
                            <div class="bg-gray-50 rounded-lg p-4 space-y-4">
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Họ và tên:</span>
                                        <span class="font-medium" id="owner-name">---</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Ngày sinh:</span>
                                        <span class="font-medium" id="owner-dob">---</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Giới tính:</span>
                                        <span class="font-medium" id="owner-gender">---</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Số CCCD:</span>
                                        <span class="font-medium" id="owner-cccd">---</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Nơi cấp CCCD:</span>
                                        <span class="font-medium" id="owner-cccd-place">---</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Ngày cấp CCCD:</span>
                                        <span class="font-medium" id="owner-cccd-date">---</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Dân tộc:</span>
                                        <span class="font-medium" id="owner-ethnicity">---</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Quốc tịch:</span>
                                        <span class="font-medium" id="owner-nationality">---</span>
                                    </div>
                                </div>
                                <div>
                                    <span class="text-gray-600 block mb-1">Địa chỉ thường trú:</span>
                                    <span class="font-medium text-right block" id="owner-address">---</span>
                                </div>
                                <div>
                                    <span class="text-gray-600 block mb-1">Nơi ở hiện tại:</span>
                                    <span class="font-medium text-right block" id="owner-current-address">---</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Số điện thoại:</span>
                                    <span class="font-medium" id="owner-phone">---</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Email:</span>
                                    <span class="font-medium" id="owner-email">---</span>
                                </div>

                                <div class="mt-4">
                                    <h4 class="text-sm font-medium text-gray-700 mb-2">Ảnh chân dung</h4>
                                    <div class="bg-gray-100 rounded-lg overflow-hidden w-32 h-40 mx-auto">
                                        <img id="owner-photo" src="" alt="Ảnh chân dung"
                                            class="w-full h-full object-cover">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column -->
                    <div class="space-y-6">
                        <!-- Thông tin phương tiện -->
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-3 flex items-center">
                                <i class="fas fa-car mr-2 text-purple-600"></i>
                                Thông Tin Phương Tiện
                            </h3>
                            <div class="bg-gray-50 rounded-lg p-4 space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Hãng sản xuất:</span>
                                    <span class="font-medium" id="vehicle-brand">---</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Model/Dòng xe:</span>
                                    <span class="font-medium" id="vehicle-model">---</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Màu sắc:</span>
                                    <span class="font-medium" id="vehicle-color">---</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Loại xe:</span>
                                    <span class="font-medium" id="vehicle-type">---</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Năm sản xuất:</span>
                                    <span class="font-medium" id="vehicle-year">---</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Dung tích xi lanh:</span>
                                    <span class="font-medium" id="vehicle-engine">---</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Số chỗ ngồi:</span>
                                    <span class="font-medium" id="vehicle-seats">---</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Nhiên liệu:</span>
                                    <span class="font-medium" id="vehicle-fuel">---</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Công suất:</span>
                                    <span class="font-medium" id="vehicle-power">---</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Số khung:</span>
                                    <span class="font-medium" id="vehicle-chassis">---</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Số máy:</span>
                                    <span class="font-medium" id="vehicle-engine-number">---</span>
                                </div>
                            </div>
                        </div>

                        <!-- Giấy tờ xe -->
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-3 flex items-center">
                                <i class="fas fa-file-alt mr-2 text-orange-600"></i>
                                Giấy Tờ Xe
                            </h3>
                            <div class="bg-gray-50 rounded-lg p-4 space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Số đăng ký xe:</span>
                                    <span class="font-medium" id="vehicle-reg-number">---</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Số tem giấy chứng nhận:</span>
                                    <span class="font-medium" id="vehicle-cert-number">---</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Cơ quan đăng ký:</span>
                                    <span class="font-medium" id="vehicle-reg-office">---</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Ngày đăng ký:</span>
                                    <span class="font-medium" id="vehicle-reg-date">---</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Ngày hết hạn đăng ký:</span>
                                    <span class="font-medium" id="vehicle-exp-date">---</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Mục đích sử dụng:</span>
                                    <span class="font-medium" id="vehicle-purpose">---</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Tình trạng xe:</span>
                                    <span class="font-medium" id="vehicle-condition">---</span>
                                </div>
                            </div>
                        </div>

                        <!-- Giấy tờ khác -->
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-3 flex items-center">
                                <i class="fas fa-certificate mr-2 text-yellow-600"></i>
                                Giấy Tờ Khác
                            </h3>
                            <div class="bg-gray-50 rounded-lg p-4 space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Bảo hiểm trách nhiệm:</span>
                                    <span class="font-medium" id="vehicle-insurance">---</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Ngày hết hạn BH:</span>
                                    <span class="font-medium" id="vehicle-insurance-exp">---</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Giấy phép lái xe:</span>
                                    <span class="font-medium" id="owner-license">---</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Hạng GPLX:</span>
                                    <span class="font-medium" id="owner-license-class">---</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Ngày cấp GPLX:</span>
                                    <span class="font-medium" id="owner-license-date">---</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Nơi cấp GPLX:</span>
                                    <span class="font-medium" id="owner-license-place">---</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Modal Actions -->
                <div class="flex justify-end space-x-3 mt-8 pt-6 border-t border-gray-200">
                    <button class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">
                        <i class="fas fa-download mr-2"></i>
                        Tải về
                    </button>
                    <button class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        <i class="fas fa-print mr-2"></i>
                        In biên bản
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const video = document.getElementById('video-player');

            // Đây là đường dẫn mà server Express cung cấp ở bước 2
            const hlsUrl = 'http://localhost:3000/hls/playlist.m3u8';

            if (Hls.isSupported()) {
                // Nếu trình duyệt hỗ trợ HLS.js
                console.log("Sử dụng HLS.js");
                const hls = new Hls();
                hls.loadSource(hlsUrl);
                hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED, () => {
                    video.play();
                });
            }
            else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                // Nếu trình duyệt hỗ trợ HLS gốc (ví dụ: Safari)
                console.log("Sử dụng HLS gốc (Safari)");
                video.src = hlsUrl;
                video.addEventListener('loadedmetadata', () => {
                    video.play();
                });
            }
        });
    </script>
</body>

</html>